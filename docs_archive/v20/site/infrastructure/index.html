<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="vadim andriyanov">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Common Infrastructure - Runtime Editor</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Common Infrastructure";
    var mkdocs_page_input_path = "infrastructure.md";
    var mkdocs_page_url = "/infrastructure/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Runtime Editor</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../general/">General</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../transform-handles/">Transform Handles</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../gizmos/">Gizmos</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rendering/">Rendering</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Common Infrastructure</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#common-infrastructure-docs">Common Infrastructure Docs</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l3" href="#expose-to-editor">Expose To Editor</a></li>
        
            <li><a class="toctree-l3" href="#event-methods">Event methods</a></li>
        
            <li><a class="toctree-l3" href="#ioc">IOC</a></li>
        
            <li><a class="toctree-l3" href="#irte-interface">IRTE interface</a></li>
        
            <li><a class="toctree-l3" href="#input">Input</a></li>
        
            <li><a class="toctree-l3" href="#rte-component">RTE Component</a></li>
        
            <li><a class="toctree-l3" href="#runtime-selection">Runtime Selection</a></li>
        
            <li><a class="toctree-l3" href="#runtime-objects">Runtime Objects</a></li>
        
            <li><a class="toctree-l3" href="#runtime-tools">Runtime Tools</a></li>
        
            <li><a class="toctree-l3" href="#runtime-undo">Runtime Undo</a></li>
        
            <li><a class="toctree-l3" href="#drag-and-drop">Drag And Drop</a></li>
        
            <li><a class="toctree-l3" href="#runtime-window">Runtime Window</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../runtime-editor/">Runtime Editor</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../save-load/">Save Load</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../dock-panels/">Dock Panels</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../vtv/">Virtualizing Tree View</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../menu-control/">Menu Control</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Runtime Editor</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Common Infrastructure</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="common-infrastructure-docs">Common Infrastructure Docs</h1>
<h2 id="overview">Overview</h2>
<p>Common infrastructure classes and interfaces form core api of runtime editor. Among other there are <a href="#runtime-selection">selection</a>, <a href="#runtime-objects">object lifecycle</a>, 
<a href="#runtime-tools">tools</a>, <a href="#runtime-undo">undo-redo</a> and <a href="#drag-and-drop">drag&amp;drop</a> API's.</p>
<h2 id="expose-to-editor">Expose To Editor</h2>
<p>Add Assets/Battlehub/RTCommon/Scripts/<strong>ExposeToEditor</strong> component to any Game Object you want to make available for selection and editing.</p>
<p><img alt="Screenshot" src="../img/infrastructure/expose-to-editor/expose-to-editor.png" /></p>
<p>UnityEvents:</p>
<ul>
<li><code>Selected Event</code> raised when object added to <a href="#runtime-selection">Runtime Selection</a>.</li>
<li><code>Unselected Event</code> raised when object removed from <a href="#runtime-selection">Runtime Selection</a>.</li>
</ul>
<p>Fields &amp; Properties:</p>
<ul>
<li><code>AddColliders</code> – add colliders to enable selection? (default: true).</li>
<li><code>Bounds Object</code> – reference to GameObject which will be used to draw <a href="../transform-handles/#selection-gizmo">Selection Gizmo</a>.</li>
<li><code>Custom Bounds</code> – used if BoundsType == Custom.</li>
<li><code>Bounds Type</code>:  <ul>
<li><em>Mesh</em> – MeshFilter.mesh.bounds will be used to draw <a href="../transform-handles/#selection-gizmo">Selection Gizmo</a>.</li>
<li><em>SkinnedMesh</em> – SkinnedMeshRenderer.mesh.bounds will be used to draw <a href="../transform-handles/#selection-gizmo">Selection Gizmo</a>.</li>
<li><em>Custom</em> – user defined bounds.</li>
<li><em>Any</em> – any of the above.</li>
</ul>
</li>
</ul>
<h2 id="event-methods">Event methods</h2>
<p>Event methods are called for all scripts of game objects with the <a href="#expose-to-editor">Expose To Editor</a> component attached. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RuntimeAwake, RuntimeStart, OnRuntimeDestroy,  OnRuntimeActivate, OnRuntimeDeactivate are called in play mode only. 
 See <code>IsPlaying</code> property of <a href="#irte-interface">IRTE interface</a></p>
</div>
<pre><code class="C#">using UnityEngine;

public class ScriptEventsExample : MonoBehaviour
{
    private void RuntimeAwake()
    {
        Debug.Log(&quot;Awake in play mode&quot;);
    }

    private void RuntimeStart()
    {
        Debug.Log(&quot;Start in play mode&quot;);
    }

    private void OnRuntimeDestroy()
    {
        Debug.Log(&quot;Destroy in play mode&quot;);
    }

    private void OnRuntimeActivate()
    {
        Debug.Log(&quot;Game View activated&quot;);
    }

    private void OnRuntimeDeactivate()
    {
        Debug.Log(&quot;Game View deactivated&quot;);
    }

    private void OnRuntimeEditorOpened()
    {
        Debug.Log(&quot;Editor Opened&quot;);
    }

    private void OnRuntimeEditorClosed()
    {
        Debug.Log(&quot;Editor Closed&quot;);
    }
}
</code></pre>

<h2 id="ioc">IOC</h2>
<p>Assets/Battlehub/RTCommon/Scripts/Utis/<strong>IOC</strong> is used for implementing simple dependency injection.</p>
<p>Methods:</p>
<ul>
<li><code>static T Resolve&lt;T&gt;()</code> - resolve dependency of type 'T'</li>
<li><code>static void Register&lt;T&gt;(Func&lt;T&gt; func)</code> - register construction function.</li>
<li><code>static void Register&lt;T&gt;(T instance)</code> - register instance.</li>
<li><code>static void Unregister&lt;T&gt;(Func&lt;T&gt; func)</code> - unregister construction function.</li>
<li><code>static void Register&lt;T&gt;(T instance)</code> - unregister instance.</li>
</ul>
<p>Example 1:</p>
<pre><code class="C#"> using UnityEditor;
 using Battlehub.RTCommon;

 public interface IDependency { }

 public class Dependency : MonoBehaviour, IDependency
 {
    void Awake()
    {
        IOC.Register&lt;IDependency&gt;(this);
    }
 }

 public class User : MonoBehaviour
 {
    void Start()
    {
        IDependency dependency = IOC.Resolve&lt;IDependency&gt;();
    }
 }

</code></pre>

<p>Example 2:</p>
<pre><code class="C#"> using UnityEditor;
 using Battlehub.RTCommon;

 [DefaultExecutionOrder(-1)]
 public class Registrar : MonoBehaviour
 {
    void Awake()
    {
        IOC.Register&lt;IDependency&gt;( () =&gt; 
        {
            GameObject go = new GameObject();
            return go.AddComponent&lt;Dependency&gt;();
        });
    }
 }

 public interface IDependency { }
 public class Dependency : MonoBehaviour, IDependency
 {
 }

 public class User : MonoBehaviour
 {
    void Awake()
    {
        IDependency dependency = IOC.Resolve&lt;IDependency&gt;();
    }
 }

</code></pre>

<h2 id="irte-interface">IRTE interface</h2>
<p>Core editor functions and APIs are accessible through IRTE interface. This interface defined in Assets/Battlehub/RTCommon/Scripts/<strong>RTEBase.cs</strong></p>
<p>Properties:</p>
<ul>
<li><code>CameraLayerSettings CameraLayerSettings { get; }</code> - layers used by <a href="../rendering/#runtime-graphics-layer">Runtime Graphics Layer</a>.</li>
<li><code>IInput Input { get; }</code> - low level <a href="#input">input</a>.</li>
<li><code>IRuntimeSelection Selection { get; }</code> - <a href="#runtime-selection">selection</a> functionality.</li>
<li><code>IRuntimeUndo Undo { get; }</code> - <a href="#runtime-undo">undo redo</a> functionality.</li>
<li><code>RuntimeTools Tools { get; }</code> - <a href="#runtime-tools">tools</a> functionality.</li>
<li><code>CursorHelper CursorHelper { get; }</code> - cursor helper.</li>
<li><code>IRuntimeObjects Object { get; }</code> - <a href="#runtime-objects">object</a> lifecycle events.</li>
<li><code>IDragDrop DragDrop { get; }</code> - <a href="#drag-and-drop">drag and drop</a> functions.</li>
<li><code>bool IsOpened { get; set; }</code> - is editor opened? </li>
<li><code>bool IsBusy { get; set; }</code> - is editor busy? blocks user input.</li>
<li><code>bool IsPlaymodeStateChanging { get; }</code> - is editor either in play mode, or about to switch to it? </li>
<li><code>bool IsPlaying { get; set; }</code> - is editor currently in play mode?</li>
<li><code>bool IsApplicationPaused { get; }</code> - is application paused?</li>
<li><code>Transform Root { get; }</code> -  editor root transform.</li>
<li><code>RuntimeWindow ActiveWindow { get; }</code> - currently active <a href="#runtime-window">window</a>. </li>
<li><code>RuntimeWindow[] Windows { get; }</code> - all registered windows.</li>
</ul>
<p>Methods:</p>
<ul>
<li>
<p><code>void ActivateWindow(RuntimeWindow window);</code> - active window and associated <a href="#rte-component">RTE Components</a> will receive user input.</p>
</li>
<li>
<p><code>void RegisterCreatedObjects(GameObject[] go);</code> - register created game objects to undo stack.</p>
</li>
<li><code>void Duplicate(GameObject[] go);</code> - duplicate objects and register created duplicates to undo stack.</li>
<li><code>void Delete(GameObject[] go);</code> - delete game objects and register this operation to undo stack.</li>
</ul>
<p>Events:</p>
<ul>
<li><code>RTEEvent PlaymodeStateChanging</code> - raised before play mode change.</li>
<li><code>RTEEvent PlaymodeStateChanged</code> - raised when play mode state changed.</li>
<li><code>RTEEvent ActiveWindowChanged</code> - raised when window activated.</li>
<li><code>RTEEvent&lt;RuntimeWindow&gt; WindowRegistered</code> - raised when window registered.</li>
<li><code>RTEEvent&lt;RuntimeWindow&gt; WindowUnregistered</code> - raised when window unregistered.</li>
<li><code>RTEEvent IsOpenedChanged</code> - raised when IsOpened property changed.</li>
</ul>
<p>Here is how to get reference to <strong>IRTE</strong>:</p>
<pre><code class="C#"> using UnityEngine;
 using Battlehub.RTCommon;

 public class GetIRTE : MonoBehaviour
 {
    void Awake()
    {
        IRTE editor = IOC.Resolve&lt;IRTE&gt;();
    }
 }

</code></pre>

<p>Open and play example:</p>
<pre><code class="C#"> using UnityEngine;
 using Battlehub.RTCommon;

 public class OpenAndPlay : MonoBehaviour
 {
    void Awake()
    {
        IRTE rte = IOC.Resolve&lt;IRTE&gt;();
        rte.IsOpened = true;
        rte.IsPlaying = true;
    }
 }

</code></pre>

<p>Lock user input example:</p>
<pre><code class="C#"> using UnityEngine;
 using System.Collections;
 using Battlehub.RTCommon;

 public class BlockUserInput : MonoBehaviour
 {
    IRTE m_rte;

    void Start()
    {
        m_rte = IOC.Resolve&lt;IRTE&gt;();
        StartCoroutine(DummyOperation());
    }

    IEnumerator DummyOperation()
    {
        yield return new WaitWhile(() =&gt; m_rte.IsBusy);

        m_rte.IsBusy = true;
        Debug.Log(&quot;User input locked&quot;);

        yield return new WaitForSeconds(5);

        m_rte.IsBusy = false;
        Debug.Log(&quot;User input unlocked&quot;);
    }
 }

</code></pre>

<h2 id="input">Input</h2>
<p><a href="../runtime-editor/">Runtime editor</a>, <a href="../transform-handles/">transform handels</a> and <a href="../gizmos/">gizmos</a> are using IInput interface to access user input.
Here is how to get reference to IInput:</p>
<pre><code class="C#"> using UnityEngine;
 using Battlehub.RTCommon;

 public class GetIRTE : MonoBehaviour
 {
    void Awake()
    {
        IInput input = IOC.Resolve&lt;IRTE&gt;().Input;
    }
 }

</code></pre>

<p>IInput has following methods:</p>
<ul>
<li><code>bool IsAnyKeyDown()</code></li>
<li><code>float GetAxis(InputAxis axisType)</code> </li>
<li><code>bool GetKeyDown(KeyCode key)</code></li>
<li><code>bool GetKeyUp(KeyCode key)</code></li>
<li><code>bool GetKey(KeyCode key)</code>        </li>
<li><code>Vector3 GetPointerXY(int pointer)</code></li>
<li><code>bool GetPointerDown(int button)</code></li>
<li><code>bool GetPointerUp(int button)</code>        </li>
<li><code>bool GetPointer(int button)</code></li>
</ul>
<h2 id="rte-component">RTE Component</h2>
<p>Assets/Battlehub/RTCommon/Scripts/<strong>RTEComponent</strong> is the base class for all <a href="../transform-handles/">transform handles</a> and <a href="../gizmos/">gizmos</a>.
It hold reference to <a href="#runtime-window">runtime window</a> and check if this window is in active state. </p>
<h2 id="runtime-selection">Runtime Selection</h2>
<p><strong>IRuntimeSelection</strong> interface defined in Assets/Battlehub/RTCommon/Scripts/<strong>RuntimeSelection.cs</strong>. Here is how subscribe to <code>SelectionChanged</code> event and select object:</p>
<pre><code class="C#"> using UnityEditor;
 using Battlehub.RTCommon;

 public class SelectObjectBehaviour : MonoBehaviour
 {
    IRuntimeSelection m_selection;

    void Start()
    {
        m_selection = IOC.Resolve&lt;IRTE&gt;().Selection;
        m_selection.SelectionChanged += OnSelectionChanged;

        GameObject go = new GameObject();
        go.AddComponent&lt;ExposeToEditor&gt;();

        m_selection.activeObject = go;
    }

    void OnDestroy()
    {
        if(m_selection != null)
        {
            m_selection.SelectionChanged -= OnSelectionChanged;
        }
    }

    void OnSelectionChanged(Object[] unselectedObjects)
    {
        if(unselectedObjects != null)
        {
            for(int i = 0; i &lt; unselectedObjects.Length; ++i)
            {
                Object unselected = unselectedObjects[i];
                Debug.Log(unselected);
            }
        }

        if(m_selection.objects != null)
        {
            for(int i = 0; i &lt; m_selection.objects.Length; ++i)
            {
                Object selected = m_selection.objects[i];
                Debug.Log(selected);
            }

        }
 }

</code></pre>

<h2 id="runtime-objects">Runtime Objects</h2>
<p><strong>IRuntimeObjects</strong> interface defined in Assets/Battlehub/RTCommon/Scripts/<strong>RuntimeObjects.cs</strong>. It can be used to track lifecycle events of objects exposed to editor.</p>
<p>Methods:</p>
<ul>
<li><code>IEnumerable&lt;ExposeToEditor&gt; Get(bool rootsOnly, bool useCache = true)</code> - call this method to get exposed to editor objects. If <code>rootsOnly</code> parameter set to <em>false</em> it return all objects, otherwise it return objects without parent.
    If <code>useCache</code> parameter set to <em>false</em>, then full traversal of object tree will be used.</li>
</ul>
<p>Events:</p>
<ul>
<li><code>event ObjectEvent Awaked</code> - see corresponding <a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">MonoBehaviour event</a>.</li>
<li><code>event ObjectEvent Started</code> - see corresponding <a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">MonoBehaviour event</a>.</li>
<li><code>event ObjectEvent Enabled</code> - see corresponding<a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">MonoBehaviour event</a>.</li>
<li><code>event ObjectEvent Disabled</code> - see corresponding <a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">MonoBehaviour event</a>.</li>
<li><code>event ObjectEvent Destroyed</code> - see corresponding <a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">MonoBehaviour event</a>.</li>
<li><code>event ObjectEvent Destroying</code> - raised just before <code>Destroyed</code> event. </li>
<li><code>event ObjectEvent MarkAsDestroyedChanged</code> - raised when object marked as destroyed by <a href="#runtime-undo">undo&amp;redo</a>    </li>
<li><code>event ObjectEvent MarkAsDestroyedChanging</code> - raised just before <code>MarkAsDestroyedChanged</code> event.</li>
<li><code>event ObjectEvent TransformChanged</code> - position, rotation or localScale changed.</li>
<li><code>event ObjectParentChangedEvent ParentChanged</code> - transform.parent changed.</li>
<li><code>event ObjectEvent NameChanged</code> - object name changed.</li>
<li><code>event ObjectEvent&lt;Component&gt; ComponentAdded</code> - raised when new component added.</li>
</ul>
<p>Example:</p>
<pre><code class="C#">using Battlehub.RTCommon;
using UnityEngine;

public class ListenAwakeEvent : MonoBehaviour
{
    IRuntimeObjects m_object;

    void Start()
    {
        m_object = IOC.Resolve&lt;IRTE&gt;().Object;
        m_object.Awaked += OnObjectAwaked;

        GameObject go = new GameObject();
        go.AddComponent&lt;ExposeToEditor&gt;();
    }

    void OnDestroy()
    {
        if(m_object != null)
        {
            m_object.Awaked -= OnObjectAwaked;
        }
    }

    void OnObjectAwaked(ExposeToEditor obj)
    {
        Debug.Log(obj);
    }
}

</code></pre>

<h2 id="runtime-tools">Runtime Tools</h2>
<p><strong>RuntimeTools</strong> class can be found in Assets/Battlehub/RTCommon/Scripts/<strong>RuntimeObjects.cs</strong>. </p>
<p>Properties:</p>
<ul>
<li><code>LockObject LockAxes</code> - this object hold aggregated <a href="../transform-handles/#locking-axes">locking state</a> of selected objects.</li>
<li><code>UnityObject ActiveTool</code> - reference to active transform handle or gizmo. Active means that user is currently interacting with it.</li>
<li><code>RuntimeTool Current</code> - The tool that is currently selected for the Scene View:<ul>
<li><em>None</em></li>
<li><em>Move</em></li>
<li><em>Rotate</em></li>
<li><em>Scale</em></li>
<li><em>View</em>
&nbsp;</li>
</ul>
</li>
<li><code>RuntimePivotMode PivotMode</code> - Are we in <em>Center</em> or <em>Pivot</em> mode.</li>
<li><code>RuntimePivotRotation PivotRotation</code> - What's the rotation of the tool handle:<ul>
<li><em>Global</em></li>
<li><em>Local</em>
&nbsp;</li>
</ul>
</li>
</ul>
<p>If property change, corresponding event is raised:</p>
<ul>
<li><code>event RuntimeToolsEvent ToolChanged</code></li>
<li><code>event RuntimeToolsEvent PivotRotationChanged</code></li>
<li><code>event RuntimeToolsEvent PivotModeChanged</code></li>
<li><code>event RuntimeToolsEvent LockAxesChanged</code></li>
</ul>
<p>Here is how to change current tool:</p>
<pre><code class="C#">using UnityEditor;
using Battlehub.RTCommon;

public class SwitchToolBehaviour : MonoBehaviour
{
    void Start()
    {
        IRTE editor = IOC.Resolve&lt;IRTE&gt;();
        editor.Tools.Current = RuntimeTool.Rotate;
    }
}

</code></pre>

<p>Here is how to <a href="../transform-handles/#locking-axes">lock axes</a> for all selected objects:</p>
<pre><code class="C#">using UnityEditor;
using Battlehub.RTCommon;

public class LockAxesForAllObjects : MonoBehaviour
{
    IRTE m_editor;
    void Start()
    {
        m_editor = IOC.Resolve&lt;IRTE&gt;();
        m_editor.Selection.SelectionChanged += OnSelectionChanged;
        m_editor.Tools.ToolChanged += OnToolChanged;
    }

    void OnDestroy()
    {
        if(m_editor != null)
        {
            m_editor.Selection.SelectionChanged -= OnSelectionChanged;
            m_editor.Tools.ToolChanged -= OnToolChanged;
        }
    }

    void OnToolChanged()
    {
        Lock();
    }

    void OnSelectionChanged(Object[] unselectedObjects)
    {
        Lock();
    }

    static void Lock()
    {
        IRTE editor = IOC.Resolve&lt;IRTE&gt;();
        editor.Tools.LockAxes = new LockObject
        {
            PositionY = true,
            RotationX = true,
            RotationZ = true
        };
    }
}

</code></pre>

<h2 id="runtime-undo">Runtime Undo</h2>
<p><strong>IRuntimeUndo</strong> interface defined in Assets/Battlehub/RTCommon/Scripts/<strong>RuntimeUndo.cs</strong>. It is used to record changes, maintain undo/redo stack and perform
undo and redo operations.</p>
<p>Properties:</p>
<ul>
<li><code>bool Enabled { get; set; }</code> - is undo &amp; redo enabled?</li>
<li><code>bool CanUndo { get; }</code> - can undo?</li>
<li><code>bool CanRedo { get; }</code> - can redo?</li>
<li><code>bool IsRecording { get; }</code> - are we recording multiple changes?</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>void BeginRecord()</code> - begin record multiple changes.</li>
<li>
<p><code>void EndRecord()</code> - end record multiple changes.</p>
</li>
<li>
<p><code>void RegisterCreatedObjects(ExposeToEditor[] createdObjects)</code> - register created objects.</p>
</li>
<li><code>void DestroyObjects(ExposeToEditor[] destoryedObjects)</code> - register destroy objects operation.</li>
<li><code>void BeginRecordValue(object target, MemberInfo memberInfo)</code> - begin record value.</li>
<li><code>void EndRecordValue(object target, MemberInfo memberInfo)</code> - end record value.</li>
<li><code>void BeginRecordTransform(Transform target)</code> - begin record transform.</li>
<li><code>void EndRecordTransform(Transform target)</code> - end record transform.</li>
<li><code>void AddComponent(ExposeToEditor obj, Type type)</code><br />
      - add component and push corresponding record to the stack.</li>
<li>
<p><code>void DestroyComponent(Component destroy, MemberInfo[] memberInfo)</code><br />
      - destroy component and push corresponding record to the stack.</p>
</li>
<li>
<p><code>void Redo()</code> - redo.</p>
</li>
<li><code>void Undo()</code> - undo.</li>
<li><code>void Purge()</code> - purge all records. All “marked as destroyed” objects will be destroyed.</li>
<li><code>void Erase(object oldRef, object newRef)</code> - replace oldRef with newRef for all records in stack.</li>
<li><code>void Store()</code> - create new stack and store current undo&amp;redo stack.</li>
<li><code>void Restore()</code> - restore previously stored stack.</li>
</ul>
<p>Events:</p>
<ul>
<li><code>event RuntimeUndoEventHandler BeforeUndo</code> - raised before undo operation.</li>
<li><code>event RuntimeUndoEventHandler UndoCompleted</code> - raised after undo operation.</li>
<li><code>event RuntimeUndoEventHandler BeforeRedo</code> - raised before redo operation.</li>
<li><code>event RuntimeUndoEventHandler RedoCompleted</code> - raised after redo operation.</li>
<li><code>event RuntimeUndoEventHandler StateChanged</code> - raised whenever one of the following operations performed: <ul>
<li><em>Store</em></li>
<li><em>Restore</em> </li>
<li><em>Purge</em></li>
</ul>
</li>
</ul>
<p>Here is how to record value and then undo changes:</p>
<pre><code class="C#">using UnityEditor;
using Battlehub.RTCommon;

public class RecordValueThenUndoChanges : MonoBehaviour
{   
    IRuntimeUndo m_undo;

    [SerializeField]
    int m_value = 1;

    void Start()
    {
        m_undo = IOC.Resolve&lt;IRTE&gt;().Undo;
        m_undo.UndoCompleted += OnUndoCompleted;

        MemberInfo valueInfo = Strong.MemberInfo((RecordValueThenUndoChanges x) =&gt; x.m_value);

        m_undo.BeginRecordValue(this, valueInfo);
        m_value = 2;
        m_undo.EndRecordValue(this, valueInfo);

        m_undo.Undo();
    }

    void OnDestroy()
    {
        if (m_undo != null)
        {
            m_undo.UndoCompleted -= OnUndoCompleted;
        }
    }

    void OnUndoCompleted()
    {
        Debug.Log(m_value); //1
    }
}

</code></pre>

<h2 id="drag-and-drop">Drag And Drop</h2>
<p><strong>IDragDrop</strong> interface defined in Assets/Battlehub/RTCommon/Scripts/<strong>DragDrop.cs</strong>. It is used as a common interface for all drag &amp; drop operations.</p>
<p>Properties:</p>
<ul>
<li><code>object[] DragObjects { get; }</code> - objects being dragged.</li>
<li><code>object Source { get; }</code> - drag &amp; drop operation source object.</li>
<li><code>bool InProgress { get; }</code> - is drag and drop in progress?</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>void Reset()</code> - cancel current drag &amp; drop operation.</li>
<li><code>void SetCursor(KnownCursor cursorType)</code> - set cursor. <ul>
<li><em>KnownCursor.DropNowAllowed</em></li>
<li><em>KnownCursor.DropAllowed</em></li>
</ul>
</li>
<li><code>void RaiseBeginDrag(object source, object[] dragItems, PointerEventData pointerEventData)</code> <br />
 - begin drag &amp; drop.</li>
<li><code>void RaiseDrag(PointerEventData eventData)</code> - drag.</li>
<li><code>void RaiseDrop(PointerEventData pointerEventData)</code> - end drag &amp; drop.</li>
</ul>
<p>Events:</p>
<ul>
<li><code>event DragDropEventHander BeginDrag</code> - raised by <code>RaiseBeginDrag</code> method.</li>
<li><code>event DragDropEventHander Drag</code> - raised by <code>RaiseDrag</code> method.</li>
<li><code>event DragDropEventHander Drop</code> - raised by <code>RaiseDrop</code> method.</li>
</ul>
<p>In this example we will handle Drag Drop operation into console window:</p>
<pre><code class="C#">using Battlehub.RTCommon;
using UnityEngine;
using UnityEngine.EventSystems;

public class ConsoleDragDropHandler : MonoBehaviour
{
    IDragDrop m_dragDrop;
    RuntimeWindow m_target;

    void Start()
    {
        m_target = IOC.Resolve&lt;IRTE&gt;().GetWindow(RuntimeWindowType.Console);            
        m_dragDrop = IOC.Resolve&lt;IRTE&gt;().DragDrop;
        m_dragDrop.Drop += OnDrop;
    }

    void OnDestroy()
    {
        if(m_dragDrop != null)
        {
            m_dragDrop.Drop -= OnDrop;
        }
    }

    void OnDrop(PointerEventData pointerEventData)
    {
        if(m_target != null &amp;&amp; m_target.IsPointerOver)
        {
            Debug.Log(m_dragDrop.DragObjects[0]);
        }
    }
}

</code></pre>

<h2 id="runtime-window">Runtime Window</h2>
<p><strong>RuntimeWindow</strong> class can be found in Assets/Battlehub/RTCommon/Scripts/<strong>RuntimeWindow.cs</strong>.  If you want to extend <a href="#runtime-editor.md">Runtime Editor</a> with new windows, then they must be inherited from<br />
Runtime Window class. Here is how to do it:</p>
<pre><code class="C#">
using Battlehub.RTCommon;
using Battlehub.Utils;
using UnityEngine;
using UnityEngine.EventSystems;

public class CustomWindow : RuntimeWindow
{
    protected override void AwakeOverride()
    {
        WindowType = RuntimeWindowType.Custom;
        base.AwakeOverride();
    }

    protected override void OnDestroyOverride()
    {
        base.OnDestroyOverride();
    }

    protected override void OnActivated()
    {
        base.OnActivated();
        Debug.Log(&quot;On Custom Window Activated&quot;);
    }

    protected override void OnDeactivated()
    {
        base.OnDeactivated();
        Debug.Log(&quot;On Custom Window Deactivated&quot;);
    }

    public override void DragEnter(object[] dragObjects, PointerEventData eventData)
    {
        base.DragEnter(dragObjects, eventData);
        Editor.DragDrop.SetCursor(KnownCursor.DropAllowed);
        Debug.Log(&quot;On Drag Enter&quot;);
    }

    public override void DragLeave(PointerEventData eventData)
    {
        base.DragLeave(eventData);
        Editor.DragDrop.SetCursor(KnownCursor.DropNowAllowed);
        Debug.Log(&quot;On Drag Leave&quot;);
    }

    public override void Drop(object[] dragObjects, PointerEventData eventData)
    {
        base.Drop(dragObjects, eventData);
        Debug.Log(&quot;On Drop&quot;);

        for(int i = 0; i &lt; dragObjects.Length; ++i)
        {
            Debug.Log(dragObjects[i]);
        }

    }
}

</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For information on how to register custom window please proceed to -&gt; <a href="../runtime-editor/#how-to-add-custom-window-to-window-manager">this</a> &lt;- section</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../runtime-editor/" class="btn btn-neutral float-right" title="Runtime Editor">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../rendering/" class="btn btn-neutral" title="Rendering"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright © 2019 vadim.andriyanov@outlook.com</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../rendering/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../runtime-editor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
